SELECT 
    OINV."DocNum" AS "Invoice Number",  -- S·ªë h√≥a ƒë∆°n
    TO_VARCHAR(OINV."DocDate", 'DD/MM/YYYY') AS "Invoice Date",  -- Ng√†y h√≥a ƒë∆°n
    OINV."CardCode" AS "Customer Code",  -- M√£ kh√°ch h√†ng
    OCRD."CardName" AS "Customer Name",  -- T√™n kh√°ch h√†ng
    OINV."DocTotal" AS "Total Invoice Amount",  -- T·ªïng ti·ªÅn h√≥a ƒë∆°n (ƒë√£ c√≥ VAT)
    OINV."PaidToDate" AS "Amount Paid",  -- S·ªë ti·ªÅn ƒë√£ thanh to√°n
    (OINV."DocTotal" - OINV."PaidToDate") AS "Unpaid Amount",  -- S·ªë ti·ªÅn ch∆∞a thanh to√°n

    -- Tr·∫°ng th√°i thanh to√°n
    CASE 
        WHEN OINV."CANCELED" IN ('Y', 'C') THEN 'Canceled'  -- N·∫øu h√≥a ƒë∆°n b·ªã h·ªßy
        WHEN OINV."PaidToDate" >= OINV."DocTotal" THEN 'Paid'  -- N·∫øu ƒë√£ thu ƒë·ªß ti·ªÅn
        ELSE 'Unpaid'  -- N·∫øu ch∆∞a thu h·∫øt ti·ªÅn
    END AS "Payment Status",

    -- Tr·∫°ng th√°i h√≥a ƒë∆°n
    OINV."DocStatus" AS "Invoice Status",
    OINV."CANCELED" AS "Is Canceled",

    -- üìå **Th√™m 2 c·ªôt m·ªõi ·ªü cu·ªëi b·∫£ng**
    QUARTER(OINV."DocDate") AS "Quarter",  -- X√°c ƒë·ªãnh qu√Ω (1-4)
    TO_VARCHAR(OINV."DocDate", 'YYYY-MM') AS "Year-Month"  -- Hi·ªÉn th·ªã nƒÉm-th√°ng

FROM PRD.OINV OINV  -- B·∫£ng h√≥a ƒë∆°n A/R
LEFT JOIN PRD.OCRD OCRD ON OINV."CardCode" = OCRD."CardCode"  -- L·∫•y th√¥ng tin kh√°ch h√†ng

WHERE 
    OINV."CardCode" IN ('211047', '211057', '211058', '211059', '211060', '211061', '216012', '211062', '216014', '216015', '216016', '216017', '216018', '216019', '216020', '216021', '211063', '216022', '216023', '216024', '216025', '211064', '216026', '216027', '216028', '211065', '211066', '216029', '211067', '211068', '211069', '211070', '211071', '216030', '211072', '216032', '216013', '216031', '216033', '211073', '211074', '211075', '211076', '211077', '211078', '211079', '211080', '216034', '211081', '211082', '211084', '211083', '211085', '211086', '211087', '211088', '211089', '211090', '211091', '211092', '211129', '211048', '211050', '211051', '211052', '211053', '216009', '216007', '211046', '211044', '211105', '211106', '211107', '211108', '211049', '211055', '216036', '216008', '216037', '216038', '216039', '216040', '216041', '216042', '216043', '216044', '216045', '216046', '216047', '216048', '216049', '216050', '216051', '216052', '216053', '216054', '216055', '216056', '216057', '216058', '216059', '216060', '216061', '216062', '216063', '216064', '216065', '216066', '216084', '216083', '216082', '216081', '216080', '216079', '216077', '216078', '216076', '216075', '216074', '216073', '216072', '216071', '216070', '216069', '216068', '216067', '211119', '211120', '211056', '211093', '211094', '211095', '211097', '211098', '211099', '211100', '211102', '211103', '211104', '211110', '211111', '211112', '211113', '211114', '211115', '211116', '211117', '211118', '211121', '211109', '211123', '211124', '211125', '211126', '211127', '216085', '216086', '211128')

ORDER BY 
    OINV."DocDate" DESC, 
    OINV."DocNum";
